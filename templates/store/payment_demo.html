{% extends "base.html" %}
{% block title %}Stripe Payment{% endblock %}
{% block content %}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-6 col-md-8">
      <div class="card border-0 shadow-lg rounded-4 overflow-hidden text-center p-4">
        <h3 class="fw-bold text-success mb-3">Stripe Payment</h3>
        <p class="text-muted">Order for <strong>{{ order.item.name }}</strong> Ã— {{ order.quantity }}</p>
        <h4 class="fw-bold mb-4">{{ order.total_price }} Tk</h4>

        <button id="checkout-button" class="btn btn-gradient w-100 py-2 fw-bold shadow-sm">
          ðŸ’³ Pay with Stripe
        </button>

        <p class="text-muted small mt-3">Use test card: <strong>4242 4242 4242 4242</strong></p>
      </div>
    </div>
  </div>
</div>

<script src="https://js.stripe.com/v3/"></script>
<script>
var stripe = Stripe("{{ STRIPE_PUBLIC_KEY }}");
var checkoutButton = document.getElementById("checkout-button");

checkoutButton.addEventListener("click", function () {
  fetch("/create-checkout-session/{{ order.id }}/", {
    method: "POST",
    headers: {
      "X-CSRFToken": "{{ csrf_token }}"
    },
  })
    .then(function (response) { return response.json(); })
    .then(function (session) {
      return stripe.redirectToCheckout({ sessionId: session.id });
    })
    .then(function (result) {
      if (result.error) { alert(result.error.message); }
    })
    .catch(function (error) {
      console.error("Error:", error);
    });
});
</script>

<style>
  .btn-gradient {
    background: linear-gradient(135deg, #28a745, #20c997);
    border: none;
    color: #fff;
    transition: all 0.3s ease-in-out;
    border-radius: 12px;
  }
  .btn-gradient:hover {
    background: linear-gradient(135deg, #20c997, #28a745);
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(0,0,0,0.15);
  }
</style>
{% endblock %}
